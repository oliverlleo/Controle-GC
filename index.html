<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle GC</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos gerais */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* Container principal */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Títulos */
        h2 {
            color: #2c3e50; /* Azul escuro minimalista */
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 700;
            border-bottom: 2px solid #e0e0e0; /* Linha sutil */
            padding-bottom: 10px;
        }

        /* Labels */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        /* Inputs e selects */
        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
            background-color: #f9f9f9;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            border-color: #2c3e50; /* Azul escuro minimalista */
            outline: none;
        }

        /* Botão */
        button {
            background-color: #2c3e50; /* Azul escuro minimalista */
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            max-width: 200px;
        }

        button:hover {
            background-color: #1a2a3a; /* Azul mais escuro */
        }

        /* Tabela */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #2c3e50; /* Azul escuro minimalista */
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        /* Barra de pesquisa */
        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            max-width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
            background-color: #f9f9f9;
            transition: border-color 0.3s ease;
        }

        .search-bar input:focus {
            border-color: #2c3e50; /* Azul escuro minimalista */
            outline: none;
        }

        /* Margens e espaçamentos */
        .section {
            margin-bottom: 30px;
        }

        /* Layout de colunas */
        .columns {
            display: flex;
            gap: 20px; /* Espaçamento entre colunas */
        }

        .columns > div {
            flex: 1;
        }

        /* Gerenciamento de Pergaminhos */
        .pergaminhos {
            display: flex;
            gap: 20px; /* Espaçamento entre os inputs */
        }

        .pergaminhos input {
            max-width: 100px; /* Tamanho menor para números de até 4 dígitos */
        }

        /* Responsividade */
        @media (max-width: 600px) {
            h2 {
                font-size: 20px;
            }

            .columns {
                flex-direction: column;
            }

            .pergaminhos {
                flex-direction: column;
            }

            .pergaminhos input {
                max-width: 100%;
            }

            button {
                width: 100%;
                max-width: 100%;
            }

            /* Barra de rolagem horizontal para a tabela em dispositivos móveis */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Gerenciamento de Pergaminhos -->
        <div class="section">
            <h2>Gerenciamento de Pergaminhos</h2>
            <div class="pergaminhos">
                <div>
                    <label>Pergaminho Único:</label>
                    <input type="number" id="pergaminho_unico" oninput="salvarPergaminhos()">
                </div>
                <div>
                    <label>Pergaminho Aleatório:</label>
                    <input type="number" id="pergaminho_aleatorio" oninput="salvarPergaminhos()">
                </div>
            </div>
        </div>

        <!-- Selecione as opções -->
        <div class="section">
            <h2>Controle de Itens</h2>
            <div class="columns">
                <div>
                    <label>Personagem:</label>
                    <select id="personagem">
                        <option>Elesis</option>
                        <option>Lire</option>
                        <option>Arme</option>
                        <option>Lass</option>
                        <option>Ryan</option>
                        <option>Ronan</option>
                        <option>Amy</option>
                        <option>Jin</option>
                        <option>Sieghart</option>
                        <option>Mari</option>
                        <option>Dio</option>
                        <option>Zero</option>
                        <option>Rey</option>
                        <option>Lupus</option>
                        <option>Lin</option>
                        <option>Azin</option>
                        <option>Holy</option>
                        <option>Edel Frost</option>
                        <option>Veigas</option>
                        <option>Uno</option>
                        <option>Decane</option>
                        <option>Ai</option>
                        <option>Kallia Eldepel</option>
                    </select>
                    
                    <label>Brinco:</label>
                    <select id="brinco">
                        <option>Nenhum</option>
                        <option>Harkyon</option>
                        <option>Normal</option>
                        <option>Épico</option>
                        <option>Lendário</option>
                    </select>
                </div>
                <div>
                    <label>Piercing:</label>
                    <select id="piercing">
                        <option>Nenhum</option>
                        <option>Harkyon</option>
                        <option>Normal</option>
                        <option>Épico</option>
                        <option>Lendário</option>
                    </select>
                    
                    <label>Anel:</label>
                    <select id="anel">
                        <option>Nenhum</option>
                        <option>Harkyon</option>
                        <option>Nível 1.1</option>
                        <option>Nível 1.2</option>
                        <option>Nível 1.3</option>
                        <option>Nível 2.1</option>
                        <option>Nível 2.2</option>
                        <option>Nível 2.3</option>
                        <option>Nível 3.1</option>
                        <option>Nível 3.2</option>
                        <option>Nível 3.3</option>
                    </select>
                </div>
                <div>
                    <label>Berkas:</label>
                    <select id="berkas">
                        <option>Nenhum</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>Full</option>
                    </select>
                </div>
            </div>
            <!-- Botão "Salvar GC" em uma nova linha -->
            <button id="salvarGC">Salvar GC</button>
        </div>

        <!-- Lista de GCs Salvos -->
        <div class="section">
            <h2>Controle Personagens</h2>
            <!-- Barra de pesquisa -->
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Pesquisar personagem..." oninput="filtrarTabela()">
            </div>
            <table id="tabela-gc">
                <tr>
                    <th>Personagem</th>
                    <th>Brinco</th>
                    <th>Piercing</th>
                    <th>Anel</th>
                    <th>Berkas</th>
                </tr>
            </table>
        </div>
    </div>

    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCL2gnsUQYc7SisbqshN9Q0Y7qwwzoPF1s",
            authDomain: "gc-controle.firebaseapp.com",
            databaseURL: "https://gc-controle-default-rtdb.firebaseio.com", // URL do Realtime Database
            projectId: "gc-controle",
            storageBucket: "gc-controle.firebasestorage.app",
            messagingSenderId: "3109203796",
            appId: "1:3109203796:web:f8619117f915f67ceba2c1",
            measurementId: "G-3NNXXD5V2T"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Função para salvar pergaminhos
        function salvarPergaminhos() {
            const pergaminhoUnico = document.getElementById("pergaminho_unico").value;
            const pergaminhoAleatorio = document.getElementById("pergaminho_aleatorio").value;

            console.log("Salvando pergaminhos:", pergaminhoUnico, pergaminhoAleatorio); // Log para depuração

            // Salva os valores no Firebase
            set(ref(db, 'pergaminhos/'), {
                unico: pergaminhoUnico,
                aleatorio: pergaminhoAleatorio
            }).then(() => {
                console.log("Pergaminhos salvos com sucesso!");
            }).catch((error) => {
                console.error("Erro ao salvar pergaminhos: ", error);
            });
        }

        // Função para carregar pergaminhos
        function carregarPergaminhos() {
            get(ref(db, 'pergaminhos/')).then((snapshot) => {
                if (snapshot.exists()) {
                    // Preenche os campos com os valores salvos
                    document.getElementById("pergaminho_unico").value = snapshot.val().unico || "0";
                    document.getElementById("pergaminho_aleatorio").value = snapshot.val().aleatorio || "0";
                    console.log("Pergaminhos carregados com sucesso!");
                } else {
                    console.log("Nenhum valor de pergaminho salvo ainda.");
                }
            }).catch((error) => {
                console.error("Erro ao carregar pergaminhos: ", error);
            });
        }

        // Função para verificar se o personagem já existe
        function personagemJaExiste(personagem, callback) {
            get(ref(db, 'gc/' + personagem)).then((snapshot) => {
                if (snapshot.exists()) {
                    callback(true); // Personagem já existe
                } else {
                    callback(false); // Personagem não existe
                }
            }).catch((error) => {
                console.error("Erro ao verificar personagem: ", error);
            });
        }

        // Função para salvar GC
        function salvarGC() {
            let personagem = document.getElementById("personagem").value;
            let brinco = document.getElementById("brinco").value;
            let piercing = document.getElementById("piercing").value;
            let anel = document.getElementById("anel").value;
            let berkas = document.getElementById("berkas").value;

            if (!personagem || !brinco || !piercing || !anel || !berkas) {
                alert("Preencha todos os campos!");
                return;
            }

            // Verifica se o personagem já existe
            personagemJaExiste(personagem, (existe) => {
                if (existe) {
                    // Se o personagem já existe, pede confirmação
                    const confirmacao = confirm("Este personagem já foi salvo. Tem certeza que deseja alterar?");
                    if (!confirmacao) {
                        return; // Cancela a operação se o usuário escolher "Não"
                    }
                }

                // Salva o GC no Firebase
                set(ref(db, 'gc/' + personagem), {
                    brinco: brinco,
                    piercing: piercing,
                    anel: anel,
                    berkas: berkas
                }).then(() => {
                    alert("GC salvo com sucesso!");
                    carregarGCs(); // Atualiza a tabela após salvar
                }).catch((error) => {
                    console.error("Erro ao salvar GC: ", error);
                });

                // Salva os pergaminhos ao salvar o GC
                salvarPergaminhos();
            });
        }

        // Função para carregar GCs
        function carregarGCs() {
            get(ref(db, 'gc/')).then((snapshot) => {
                if (snapshot.exists()) {
                    let tabela = document.getElementById("tabela-gc");
                    tabela.innerHTML = `
                        <tr>
                            <th>Personagem</th>
                            <th>Brinco</th>
                            <th>Piercing</th>
                            <th>Anel</th>
                            <th>Berkas</th>
                        </tr>`;
                    
                    snapshot.forEach((childSnapshot) => {
                        let dados = childSnapshot.val();
                        let linha = tabela.insertRow();
                        linha.insertCell(0).textContent = childSnapshot.key;
                        linha.insertCell(1).textContent = dados.brinco;
                        linha.insertCell(2).textContent = dados.piercing;
                        linha.insertCell(3).textContent = dados.anel;
                        linha.insertCell(4).textContent = dados.berkas;
                    });
                } else {
                    console.log("Nenhum GC salvo ainda.");
                }
            }).catch((error) => {
                console.error("Erro ao carregar GCs: ", error);
            });
        }

        // Função para filtrar a tabela
        function filtrarTabela() {
            const input = document.getElementById("searchInput");
            const filter = input.value.toUpperCase();
            const table = document.getElementById("tabela-gc");
            const tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) { // Começa em 1 para pular o cabeçalho
                const td = tr[i].getElementsByTagName("td")[0]; // Filtra pela coluna "Personagem"
                if (td) {
                    const txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        // Carrega os dados ao abrir a página
        window.onload = function() {
            carregarPergaminhos(); // Carrega os valores dos pergaminhos
            carregarGCs(); // Carrega a lista de GCs
        };

        // Adiciona o evento de clique ao botão "Salvar GC"
        document.getElementById("salvarGC").addEventListener("click", salvarGC);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Login e Controle Genérico</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Estilos gerais */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .language-selector {
  font-size: 16px; /* Ajusta o tamanho do texto */
  padding: 5px 10px; /* Ajusta o espaçamento interno */
  width: 40px; /* Define a largura do seletor */
}
    @media (max-width: 768px) {
  .language-selector {
    font-size: 14px;
    width: 40px;
  }
}
    .container {
      position: relative;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 700;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #2c3e50;
      outline: none;
    }
    button {
      background-color: #2c3e50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
    }
    button:hover {
      background-color: #1a2a3a;
    }
    .hidden {
      display: none;
    }
    /* Botões personalizados */
    #botaoRecuperar {
      background-color: #e74c3c;
    }
    #botaoRecuperar:hover {
      background-color: #c0392b;
    }
    #botaoSair {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      padding: 0;
      font-size: 16px;
      line-height: 30px;
      text-align: center;
      background-color: #2c3e50;
      transition: transform 0.2s ease;
    }
    #botaoSair:hover {
      transform: scale(1.2);
    }
    /* Botão de exclusão com X */
    .delete-button {
      background-color: #e74c3c;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    .delete-button:hover {
      background-color: #c0392b;
    }
    /* Barra de pesquisa e tabela */
    .search-bar {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }
    .search-bar input {
      flex: 1;
      max-width: 230px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
      transition: border-color 0.3s ease;
    }
    .search-bar button {
      padding: 10px 20px;
      height: 42px;
      max-width: 150px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
    }
    th {
      background-color: #2c3e50;
      color: white;
      font-weight: 600;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    /* Ajustes para os campos de quantidade */
    .pergaminhos input[type="number"] {
      max-width: 120px;
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
      transition: border-color 0.3s ease;
    }
    /* Ajustes para a tela de login */
    .login-container {
      padding: 0 10px;
    }
    .login-container input {
      width: calc(98% - 20px);
      margin-left: 10px;
      margin-right: 20px;
      padding: 8px;
      font-size: 12px;
      margin-bottom: 10px;
    }
    .login-container button {
      width: calc(100% - 20px);
      margin-left: 10px;
      margin-right: 10px;
      padding: 8px;
      font-size: 12px;
      margin-bottom: 10px;
    }
    /* Ajustes para mobile */
    @media (max-width: 600px) {
      h2 {
        font-size: 20px;
      }
      .pergaminhos input[type="number"] {
        max-width: 100%;
      }
      .search-bar {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 10px;
        padding: 0 10px;
      }
      .search-bar input {
        flex: 1 1 100%;
        max-width: 100%;
      }
      .search-bar button {
        flex: 1 1 calc(50% - 10px);
        max-width: calc(50% - 10px);
      }
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
    }
    /* Estilo do seletor de idioma dentro do bloco "Gerenciamento de Quantidade" */
    #languageSelectorContainer {
      margin-bottom: 6px;
      /* Sem posição fixa, ficará dentro do fluxo do documento */
    }
  </style>
</head>
<body>
  <!-- Tela de Login/Cadastro -->
  <div class="container" id="telaLogin">
    <h2 data-i18n="loginTitle">Login / Cadastro</h2>
    <div class="login-container">
      <label for="email" data-i18n="emailLabel">E-mail:</label>
      <input type="email" id="email" placeholder="Digite seu e-mail">
      <label for="senha" data-i18n="passwordLabel">Senha:</label>
      <input type="password" id="senha" placeholder="Digite sua senha">
      <button id="botaoLogin" data-i18n="loginButton">Login</button>
      <button id="botaoCadastro" data-i18n="registerButton">Cadastrar</button>
      <button id="botaoRecuperar" data-i18n="recoverButton">Recuperar Senha</button>
    </div>
  </div>

  <!-- Tela principal -->
  <div class="container hidden" id="telaPrincipal">
    <!-- Botão de Sair -->
    <button id="botaoSair">X</button>

    <!-- Bloco de Gerenciamento de Quantidade com Seletor de Idioma -->
    <div class="section">
      <!-- Seletor de Idioma posicionado dentro do bloco -->
      <div id="languageSelectorContainer">
        <select id="languageSelector">
          <option value="pt">Português</option>
          <option value="en">English</option>
          <option value="ko">한국어</option>
        </select>
      </div>
      <h2 data-i18n="quantityManagement">Gerenciamento de Quantidade</h2>
      <div class="pergaminhos">
        <div>
          <label data-i18n="uniqueQuantity">Quantidade Única:</label>
          <input type="number" id="quantidade_unica" oninput="atualizarQuantidades()">
        </div>
        <div>
          <label data-i18n="randomQuantity">Quantidade Aleatória:</label>
          <input type="number" id="quantidade_aleatoria" oninput="atualizarQuantidades()">
        </div>
      </div>
    </div>

    <!-- Bloco de Controle -->
    <div class="section">
      <h2 data-i18n="controlTitle">Controle</h2>
      <div class="columns">
        <div>
          <label data-i18n="userLabel">Usuário:</label>
          <select id="usuario">
            <option>Usuário 1</option>
            <option>Usuário 2</option>
            <option>Usuário 3</option>
            <option>Usuário 4</option>
            <option>Usuário 5</option>
            <option>Usuário 6</option>
            <option>Usuário 7</option>
            <option>Usuário 8</option>
            <option>Usuário 9</option>
            <option>Usuário 10</option>
            <option>Usuário 11</option>
            <option>Usuário 12</option>
            <option>Usuário 13</option>
            <option>Usuário 14</option>
            <option>Usuário 15</option>
            <option>Usuário 16</option>
            <option>Usuário 17</option>
            <option>Usuário 18</option>
            <option>Usuário 19</option>
            <option>Usuário 20</option>
            <option>Usuário 21</option>
            <option>Usuário 22</option>
            <option>Usuário 23</option>
          </select>
          
          <label data-i18n="registration1">Cadastro 1:</label>
          <select id="cadastro1">
            <option>Opção 1</option>
            <option>Opção 2</option>
            <option>Opção 3</option>
            <option>Opção 4</option>
            <option>Opção 5</option>
          </select>
        </div>
        <div>
          <label data-i18n="registration2">Cadastro 2:</label>
          <select id="cadastro2">
            <option>Opção 1</option>
            <option>Opção 2</option>
            <option>Opção 3</option>
            <option>Opção 4</option>
            <option>Opção 5</option>
          </select>
          
          <label data-i18n="registration3">Cadastro 3:</label>
          <select id="cadastro3">
            <option>Opção 1</option>
            <option>Opção 2</option>
            <option>Opção 3</option>
            <option>Opção 4</option>
            <option>Opção 5</option>
            <option>Opção 6</option>
            <option>Opção 7</option>
            <option>Opção 8</option>
            <option>Opção 9</option>
            <option>Opção 10</option>
            <option>Opção 11</option>
          </select>
        </div>
        <div>
          <label data-i18n="registration4">Cadastro 4:</label>
          <select id="cadastro4">
            <option>Opção 1</option>
            <option>Opção 2</option>
            <option>Opção 3</option>
            <option>Opção 4</option>
            <option>Opção 5</option>
            <option>Opção 6</option>
            <option>Opção 7</option>
            <option>Opção 8</option>
            <option>Opção 9</option>
            <option>Opção 10</option>
            <option>Opção 11</option>
            <option>Opção 12</option>
            <option>Opção 13</option>
          </select>
        </div>
      </div>
      <button id="botaoSalvar" data-i18n="saveButton">Salvar</button>
    </div>

    <!-- Bloco de Controle (Tabela) -->
    <div class="section">
      <h2 data-i18n="controlTitle">Controle</h2>
      <div class="search-bar">
        <input type="text" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Pesquisar usuário...">
        <button id="btnPesquisar" data-i18n="searchButton">Pesquisar</button>
        <button id="btnLimparFiltro" data-i18n="clearFilterButton">Limpar Filtro</button>
      </div>
      <table id="tabela_controle">
        <tr>
          <th data-i18n="controlTable.user">Usuário</th>
          <th data-i18n="controlTable.reg1">Cadastro 1</th>
          <th data-i18n="controlTable.reg2">Cadastro 2</th>
          <th data-i18n="controlTable.reg3">Cadastro 3</th>
          <th data-i18n="controlTable.reg4">Cadastro 4</th>
          <th data-i18n="controlTable.action">Ação</th>
        </tr>
      </table>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";

    // Configuração do Firebase
    const config = {
      apiKey: "AIzaSyCL2gnsUQYc7SisbqshN9Q0Y7qwwzoPF1s",
      authDomain: "gc-controle.firebaseapp.com",
      databaseURL: "https://gc-controle-default-rtdb.firebaseio.com",
      projectId: "gc-controle",
      storageBucket: "gc-controle.firebasestorage.app",
      messagingSenderId: "3109203796",
      appId: "1:3109203796:web:f8619117f915f67ceba2c1",
      measurementId: "G-3NNXXD5V2T"
    };

    const appFirebase = initializeApp(config);
    const database = getDatabase(appFirebase);
    const auth = getAuth(appFirebase);
    let usuarioAtual = null;

    // Elementos de tela
    const telaLogin = document.getElementById("telaLogin");
    const telaPrincipal = document.getElementById("telaPrincipal");
    const emailInput = document.getElementById("email");
    const senhaInput = document.getElementById("senha");
    const botaoLogin = document.getElementById("botaoLogin");
    const botaoCadastro = document.getElementById("botaoCadastro");
    const botaoRecuperar = document.getElementById("botaoRecuperar");
    const botaoSair = document.getElementById("botaoSair");
    const botaoSalvar = document.getElementById("botaoSalvar");
    const searchInput = document.getElementById("searchInput");
    const btnPesquisar = document.getElementById("btnPesquisar");
    const btnLimparFiltro = document.getElementById("btnLimparFiltro");
    const tabelaControle = document.getElementById("tabela_controle");

    // Inputs de quantidade
    const quantidadeUnica = document.getElementById("quantidade_unica");
    const quantidadeAleatoria = document.getElementById("quantidade_aleatoria");

    // Seletores de controle
    const usuarioSelect = document.getElementById("usuario");
    const cadastro1 = document.getElementById("cadastro1");
    const cadastro2 = document.getElementById("cadastro2");
    const cadastro3 = document.getElementById("cadastro3");
    const cadastro4 = document.getElementById("cadastro4");

    // Seletor de linguagem
    const languageSelector = document.getElementById("languageSelector");
    let currentLang = languageSelector.value; // 'pt', 'en' ou 'ko'

    // Objeto de traduções
    const translations = {
      loginTitle: {
        pt: "Login / Cadastro",
        en: "Login / Register",
        ko: "로그인 / 회원가입"
      },
      emailLabel: {
        pt: "E-mail:",
        en: "Email:",
        ko: "이메일:"
      },
      passwordLabel: {
        pt: "Senha:",
        en: "Password:",
        ko: "비밀번호:"
      },
      loginButton: {
        pt: "Login",
        en: "Login",
        ko: "로그인"
      },
      registerButton: {
        pt: "Cadastrar",
        en: "Register",
        ko: "회원가입"
      },
      recoverButton: {
        pt: "Recuperar Senha",
        en: "Recover Password",
        ko: "비밀번호 복구"
      },
      quantityManagement: {
        pt: "Gerenciamento de Quantidade",
        en: "Quantity Management",
        ko: "수량 관리"
      },
      uniqueQuantity: {
        pt: "Quantidade Única:",
        en: "Unique Quantity:",
        ko: "고유 수량:"
      },
      randomQuantity: {
        pt: "Quantidade Aleatória:",
        en: "Random Quantity:",
        ko: "랜덤 수량:"
      },
      controlTitle: {
        pt: "Controle",
        en: "Control",
        ko: "제어"
      },
      userLabel: {
        pt: "Usuário:",
        en: "User:",
        ko: "사용자:"
      },
      registration1: {
        pt: "Cadastro 1:",
        en: "Registration 1:",
        ko: "등록 1:"
      },
      registration2: {
        pt: "Cadastro 2:",
        en: "Registration 2:",
        ko: "등록 2:"
      },
      registration3: {
        pt: "Cadastro 3:",
        en: "Registration 3:",
        ko: "등록 3:"
      },
      registration4: {
        pt: "Cadastro 4:",
        en: "Registration 4:",
        ko: "등록 4:"
      },
      saveButton: {
        pt: "Salvar",
        en: "Save",
        ko: "저장"
      },
      controlTable: {
        user: {
          pt: "Usuário",
          en: "User",
          ko: "사용자"
        },
        reg1: {
          pt: "Cadastro 1",
          en: "Registration 1",
          ko: "등록 1"
        },
        reg2: {
          pt: "Cadastro 2",
          en: "Registration 2",
          ko: "등록 2"
        },
        reg3: {
          pt: "Cadastro 3",
          en: "Registration 3",
          ko: "등록 3"
        },
        reg4: {
          pt: "Cadastro 4",
          en: "Registration 4",
          ko: "등록 4"
        },
        action: {
          pt: "Ação",
          en: "Action",
          ko: "작업"
        }
      },
      searchPlaceholder: {
        pt: "Pesquisar usuário...",
        en: "Search user...",
        ko: "사용자 검색..."
      },
      searchButton: {
        pt: "Pesquisar",
        en: "Search",
        ko: "검색"
      },
      clearFilterButton: {
        pt: "Limpar Filtro",
        en: "Clear Filter",
        ko: "필터 초기화"
      }
    };

    // Função para atualizar os textos conforme o idioma selecionado
    function updateLanguage() {
      currentLang = languageSelector.value;
      // Atualiza elementos com data-i18n
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(translations[key]) {
          el.innerText = translations[key][currentLang];
        }
      });
      // Atualiza placeholders
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        if(translations[key]) {
          el.placeholder = translations[key][currentLang];
        }
      });
    }

    languageSelector.addEventListener("change", updateLanguage);
    updateLanguage();

    // Alterna as telas
    const mostrarTelaLogin = () => {
      telaLogin.classList.remove("hidden");
      telaPrincipal.classList.add("hidden");
    };

    const mostrarTelaPrincipal = async () => {
      telaLogin.classList.add("hidden");
      telaPrincipal.classList.remove("hidden");
      await carregarQuantidades();
      await carregarControles();
    };

    // Autenticação
    botaoLogin.addEventListener("click", async () => {
      try {
        const userCredential = await signInWithEmailAndPassword(auth, emailInput.value, senhaInput.value);
        usuarioAtual = userCredential.user;
        await mostrarTelaPrincipal();
      } catch (error) {
        alert("Erro no login: " + error.message);
      }
    });

    botaoCadastro.addEventListener("click", async () => {
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, emailInput.value, senhaInput.value);
        usuarioAtual = userCredential.user;
        await mostrarTelaPrincipal();
      } catch (error) {
        alert("Erro no cadastro: " + error.message);
      }
    });

    botaoRecuperar.addEventListener("click", async () => {
      if (!emailInput.value) {
        alert("Informe seu e-mail para recuperar a senha.");
        return;
      }
      try {
        await sendPasswordResetEmail(auth, emailInput.value);
        alert("E-mail de recuperação enviado.");
      } catch (error) {
        alert("Erro ao enviar e-mail: " + error.message);
      }
    });

    botaoSair.addEventListener("click", async () => {
      try {
        await signOut(auth);
        usuarioAtual = null;
        mostrarTelaLogin();
      } catch (error) {
        console.error("Erro ao sair:", error);
      }
    });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        usuarioAtual = user;
        await mostrarTelaPrincipal();
      } else {
        mostrarTelaLogin();
      }
    });

    // Quantidades
    async function atualizarQuantidades() {
      if (!usuarioAtual) return;
      try {
        await set(ref(database, `users/${usuarioAtual.uid}/quantidades`), {
          unica: quantidadeUnica.value,
          aleatoria: quantidadeAleatoria.value
        });
        console.log("Quantidades salvas com sucesso!");
      } catch (error) {
        console.error("Erro ao salvar quantidades: ", error);
      }
    }

    async function carregarQuantidades() {
      if (!usuarioAtual) return;
      try {
        const snapshot = await get(ref(database, `users/${usuarioAtual.uid}/quantidades`));
        if (snapshot.exists()) {
          const dados = snapshot.val();
          quantidadeUnica.value = dados.unica || "0";
          quantidadeAleatoria.value = dados.aleatoria || "0";
          console.log("Quantidades carregadas com sucesso!");
        } else {
          console.log("Nenhuma quantidade salva ainda.");
        }
      } catch (error) {
        console.error("Erro ao carregar quantidades: ", error);
      }
    }

    // Controle
    async function usuarioJaExiste(chaveUsuario) {
      if (!usuarioAtual) return false;
      try {
        const snapshot = await get(ref(database, `users/${usuarioAtual.uid}/controle/${chaveUsuario}`));
        return snapshot.exists();
      } catch (error) {
        console.error("Erro ao verificar usuário: ", error);
        return false;
      }
    }

    async function salvarControle() {
      const usuarioSelecionado = usuarioSelect.value;
      const dadosControle = {
        cadastro1: cadastro1.value,
        cadastro2: cadastro2.value,
        cadastro3: cadastro3.value,
        cadastro4: cadastro4.value
      };

      if (Object.values(dadosControle).some(valor => !valor)) {
        alert("Preencha todos os campos!");
        return;
      }

      if (!usuarioAtual) {
        alert("Você precisa estar logado!");
        return;
      }

      try {
        if (await usuarioJaExiste(usuarioSelecionado)) {
          if (!confirm("Este usuário já foi salvo. Tem certeza que deseja alterar?")) return;
        }
        await set(ref(database, `users/${usuarioAtual.uid}/controle/${usuarioSelecionado}`), dadosControle);
        alert("Controle salvo com sucesso!");
        await carregarControles();
        atualizarQuantidades();
      } catch (error) {
        console.error("Erro ao salvar controle: ", error);
      }
    }

    async function carregarControles() {
      if (!usuarioAtual) return;
      try {
        const snapshot = await get(ref(database, `users/${usuarioAtual.uid}/controle`));
        tabelaControle.innerHTML = `
          <tr>
            <th data-i18n="controlTable.user">Usuário</th>
            <th data-i18n="controlTable.reg1">Cadastro 1</th>
            <th data-i18n="controlTable.reg2">Cadastro 2</th>
            <th data-i18n="controlTable.reg3">Cadastro 3</th>
            <th data-i18n="controlTable.reg4">Cadastro 4</th>
            <th data-i18n="controlTable.action">Ação</th>
          </tr>
        `;
        if (snapshot.exists()) {
          snapshot.forEach(childSnapshot => {
            const dados = childSnapshot.val();
            const linha = tabelaControle.insertRow();
            let cellUsuario = linha.insertCell();
            cellUsuario.textContent = childSnapshot.key;
            let cellCadastro1 = linha.insertCell();
            cellCadastro1.textContent = dados.cadastro1;
            let cellCadastro2 = linha.insertCell();
            cellCadastro2.textContent = dados.cadastro2;
            let cellCadastro3 = linha.insertCell();
            cellCadastro3.textContent = dados.cadastro3;
            let cellCadastro4 = linha.insertCell();
            cellCadastro4.textContent = dados.cadastro4;
            let cellExcluir = linha.insertCell();
            cellExcluir.innerHTML = `<button class="delete-button" onclick="excluirControle('${childSnapshot.key}')">X</button>`;
          });
        } else {
          console.log("Nenhum controle salvo ainda.");
        }
      } catch (error) {
        console.error("Erro ao carregar controles: ", error);
      }
    }

    async function excluirControle(chaveUsuario) {
      if (!usuarioAtual) return;
      if (!confirm("Você tem certeza que deseja excluir o usuário?")) return;
      try {
        await remove(ref(database, `users/${usuarioAtual.uid}/controle/${chaveUsuario}`));
        alert("Usuário excluído com sucesso!");
        carregarControles();
      } catch (error) {
        console.error("Erro ao excluir usuário: ", error);
      }
    }

    // Filtro da tabela
    function filtrarControle() {
      const filter = searchInput.value.toUpperCase();
      const linhas = tabelaControle.getElementsByTagName("tr");
      for (let i = 1; i < linhas.length; i++) {
        const cell = linhas[i].getElementsByTagName("td")[0];
        if (cell) {
          const txtValue = cell.textContent || cell.innerText;
          linhas[i].style.display = (filter === "" || txtValue.toUpperCase().includes(filter)) ? "" : "none";
        }
      }
    }

    function limparFiltro() {
      searchInput.value = "";
      filtrarControle();
    }

    // Eventos
    botaoSalvar.addEventListener("click", salvarControle);
    btnPesquisar.addEventListener("click", filtrarControle);
    btnLimparFiltro.addEventListener("click", limparFiltro);

    // Torna funções globais para uso inline (ex.: botão de exclusão)
    window.excluirControle = excluirControle;
    window.atualizarQuantidades = atualizarQuantidades;
  </script>
</body>
</html>
